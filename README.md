Thread safe put key value store

Please feel free to suggest any optimizations
